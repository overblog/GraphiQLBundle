<!DOCTYPE html>
<html>
<head>
  {% block head %}
  {% block style %}
    <style>
      html, body, #root {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
      }
       #root .footer {
           top:0;
           left:0;
           position:absolute;
           width:100%;
       }
    </style>
  <link href="https://unpkg.com/graphiql@{{ versions.graphiql }}/graphiql.css" rel="stylesheet">
  {% endblock style %}
    {% if versions.fetch matches '/^[~^]?2/' %}
      <script src="https://unpkg.com/whatwg-fetch@{{ versions.fetch }}/fetch.js"></script>
    {% else %}
      <script src="https://unpkg.com/whatwg-fetch@{{ versions.fetch }}/dist/fetch.umd.js"></script>
    {% endif %}
    {% if versions.react matches '/^[~^]?15/' %}
      <script src="https://unpkg.com/react@{{ versions.react }}/dist/react.min.js"></script>
      <script src="https://unpkg.com/react-dom@{{ versions.react }}/dist/react-dom.min.js"></script>
    {% else %}
      <script src="https://unpkg.com/react@{{ versions.react }}/umd/react.production.min.js"></script>
      <script src="https://unpkg.com/react-dom@{{ versions.react }}/umd/react-dom.production.min.js"></script>
    {% endif %}
    <script src="https://unpkg.com/graphiql@{{ versions.graphiql }}/graphiql.min.js"></script>
    <title>{% block title %}GraphiQL{% endblock title %}</title>
  {% endblock head %}
</head>
<body>
    <div id="root"></div>
{% block body %}
  {% block body_loading %}Loading...{% endblock body_loading %}
  {% block body_script %}
    <script>
      var endpoint = {{ endpoint | json_encode | raw }}

        function graphQLFetcher(params) {
          {% block fetcher_function_body %}
          var headers

          {% block graphql_fetcher_headers %}
          headers = {
            "Accept": "application/json",
            "Content-Type": "application/json",
          }
          {% endblock graphql_fetcher_headers %}

            var footer = document.getElementsByClassName('footer');
            footer = footer[0] || null;

          return fetch(endpoint, {
              method: "post",
              headers: headers,
              body: JSON.stringify(params),
              credentials: 'include',
            }).then((res) => {
              {% block post_fetch %}{% endblock post_fetch %}
              footer.innerHTML = '';
              return res.text()
            }).then((body) => {
            try {
              return JSON.parse(body)
            } catch (err) {
                if(typeof(body) === 'string'){
                    if(footer){
                        footer.innerHTML += body;
                    }
                    return '';
                }
              return body
            }
          })
          {% endblock fetcher_function_body %}
        }

      ReactDOM.render(
        React.createElement(GraphiQL,
            {
                {% block graphiql_params %}
                fetcher: graphQLFetcher
                {% endblock graphiql_params %}
            },
            {%if logoPath is defined %}
                React.createElement(
                  GraphiQL.Logo,
                  {},
                  React.createElement(
                      'img',
                      {src:"{{ logoPath }}" }
                  )
              ),
            {% endif %}
            React.createElement(
                GraphiQL.Footer,
                {},
                ''
            )
        ),
        document.getElementById('root')
      )

    </script>
  {% endblock body_script %}
{% endblock body %}
</body>
</html>
